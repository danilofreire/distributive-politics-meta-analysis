---
title: "Appendix"
author: "Umberto Mignozzetti"
date: "12/25/2019"
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}

output: pdf_document
---

```{=latex}
\tableofcontents
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Search criteria

### Search terms

XXXX

### Searched databases

XXXX To Catarina: name and URL of database searched

### Summary total results

XXXX To Catarina: put here results per database, cross-matching, anything else

### Exclusion criteria

#### Exclusion title and abstract

XXXX To Catarina: what criteria for first round exclusions?

#### Exclusion reading

XXXX To Catarina: criteria second round exclusions

#### Exclusion analysis

For the articles that passed the first two filters, we looked into the tables and the reported coefficients. We kept articles in this step based on two criteria:

1. Matched treatment variable:
  + N: Number Legislators Lower House
  + logN: Log Number Legislators Lower House
  + K: Number Legislators Upper House
  
2. Matched outcome variable:
  + ExpPC: Expenditure Per Capita
  + logExpPC: Log Expenditure Per Capita
  + PCTGDP: Percent GDP Public Expenditure


### PRISM

- Number of articles matching the search criteria: XXXX
- Number of articles excluded after title and abstract: XXXX
- Number of articles excluded after reading: XXXX
- Number of articles excluded before analysis: 3
- Number of articles excluded during the analysis: 0

We have 26 articles in the meta-analysis.

## Meta-analysis dataset

The meta-analytic data is comprised of two datasets. The first dataset has the main coefficients that were reported in the paper. XXXX (Copiar da parte de m√©todos).

## Adding articles

```{r global_options, include=FALSE}
## Starting
set.seed(732578) # From random.org

# Needed packages
pkgs <- c('tidyverse', 'meta', 'metafor', 'readxl',
          'knitr', 'gridGraphics', 'gridExtra','ggpubr','kableExtra','magick')

# Install if not already installed
installIfNot <- function(x) {
  if(x %in% rownames(installed.packages()) == FALSE) 
    install.packages(x, dependencies = T, repos = "http://cran.us.r-project.org")
} 
lapply(pkgs, installIfNot)

# Load packs
lapply(pkgs, require, character.only = T)
rm(pkgs, installIfNot)

# Knitr options
knitr::opts_chunk$set(fig.pos = 'H') # holds figure position

# Build plot function for forest plots
build_forest <- function(mod, capt, lsize = 22) {
  # Build dataset for plot
  mod2 <- tibble(
    TE = mod$TE,
    seTE = mod$seTE,
    studlab = mod$studlab,
    lower = mod$lower,
    upper = mod$upper,
    group = "A") %>%
    bind_rows(.,
              aux = tibble(
                TE = c(mod$TE.random, NA),
                seTE = c(mod$seTE.random, NA),
                studlab = c("Overall Effect", "Prediction Interval"),
                lower = c(mod$lower.random, mod$lower.predict),
                upper = c(mod$upper.random, mod$upper.predict),
                group = "B")) %>%
    group_by(studlab) %>%
    mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
    ungroup()
  
  # Build plot
  p <- mod2 %>%
    ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
    geom_point(aes(color = group)) +
    geom_errorbarh(aes(color = group), height = 0.1) +
    scale_color_manual(values = c("#000000", "#8b0000")) +
    scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
    scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
    geom_vline(xintercept=0, color="#000000", linetype="dashed") +
    labs(x = "",
         y = "") + 
    facet_grid(group~., scales = "free", space = "free") + 
    labs(caption = capt) +
    theme_minimal() %+replace%
    theme(strip.text.y = element_blank(),
          legend.position = "none",
          axis.text.y = element_text(size = .8*lsize, hjust = 1),
          axis.text.x = element_text(size = .7*lsize, hjust = 1.1),
          plot.caption = element_text(size=lsize))
  return(p)
}
```


```{r, echo=FALSE, include=FALSE}
load('../dataset/dataCoefs.RData')
```
\newpage
## Descriptive statistics

### Study Year

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Study Year Frequencies"}
dat %>%
  ggplot(aes(x = as.factor(year))) + 
    geom_bar(color = "black") + 
  labs(x = "",
       y = "") + 
  theme_bw()
```

\newpage
### Published?

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Was the study published?"}
dat %>%
  ggplot(aes(x = as.factor(published))) + 
    geom_bar(color = "black") + 
  labs(x = "Published study?",
       y = "") + 
  theme_bw()

```

\newpage
### Dependent variables

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Dependent variables across the law of 1/n studies"}
dat %>%
  mutate(depvar2 = factor(depvar2, 
                          labels = c("Per Capita Expenditure",
                                     "Percentage GDP Government Expenditure",
                                     "Log Per Capita Expenditure"))) %>%
  ggplot(aes(x = depvar2)) +
    geom_bar(color = "black") + 
  labs(x = "Dependent Variables",
       y = "") + 
  coord_flip() + 
  theme_bw()

```

\newpage
### Independent variables

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Independent variables across the law of 1/n studies"}
dat %>%
  mutate(indepvar2 = factor(indepvar2, labels = c('K (upper house legislators)',
                                                  'N (lower house legislators)',
                                                  'Log N'))) %>%
  ggplot(aes(x = indepvar2)) + 
    geom_bar(color = "black") + 
  labs(x = "Independent Variables",
       y = "") +
  coord_flip() +
  theme_bw() 
```

\newpage
### Histogram Coefficients

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Histogram Coefficients"}
dat %>%
  ggplot(aes(x = coef)) +
  geom_histogram(bins = 15, color = "black") + 
  labs(x = "Coefficients") + 
  theme_bw()

```

\newpage
### Histogram Standard Errors

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Histogram Standard Errors"}
dat %>%
  ggplot(aes(x = SE)) +
  geom_histogram(bins = 10, color = "black") + 
  labs(x = "Standard Errors") + 
  theme_bw()

```

\newpage
### Sign Coefficients

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Coefficient Sign?"}
dat %>%
  ggplot(aes(x=as.factor(scoef))) + 
  geom_bar(color = "black") + 
  labs(x = "Coefficient Sign",
       y = "") +
  theme_bw()
```

A general test of the theory would be to study whether the coefficients are positive or negative. Note that the law of 1/n would pose that we should have a positive influence of legislature size on expenditure. To test this theory, we run a Binomial One-Proportion Z-test. For the number of legislators in the lower house (N), the results follow below.

```{r, echo=FALSE}
aux <- filter(dat, indepvar2 == 'N')
binom.test(table(aux$scoef)[1], sum(table(aux$scoef)), p=0.5)
```


Therefore, the most elementary test we could run, a sign direction test, tells us that the law of 1/n does not hold for our sample. For the number of legislators in the upper house (K), the results follow below.

```{r, echo=FALSE}
aux <- filter(dat, indepvar2 == 'K')
binom.test(table(aux$scoef)[1], sum(table(aux$scoef)), p=0.5)
```

Here, the law of 1/n holds. However, the effect goes in a direction different from the predicted in the law of k/n paper.

\newpage
### Electoral system

```{r, echo=FALSE, fig.width=7, fig.height=6, fig.cap="Electoral system"}
dat %>%
  ggplot(aes(x=as.factor(elecsys2))) + 
    geom_bar(color = "black") + 
  labs(x = "Electoral system",
       y = "") + 
  theme_bw()
```

\newpage
### Electoral system x Sign Coefficient

```{r, echo=FALSE}
table(dat$scoef, dat$elecsys2)
chisq.test(table(dat$scoef, dat$elecsys2), simulate.p.value = T)
```

\newpage
### Independent Variable x Sign Coefficient

```{r, echo=FALSE}
table(dat$scoef, dat$indepvar2)
chisq.test(table(dat$scoef, dat$indepvar2), simulate.p.value = T)
```

\newpage
### Dependent variables x Independent variables

```{r, echo=FALSE}
table(dat$scoef, dat$depvar2)
chisq.test(table(dat$scoef, dat$depvar2), simulate.p.value = T)
```

\newpage 
### Descriptive Stats of Moderators

```{r, echo=F,warning=F,message=F,error=F}

# Table 2

dat2 <- dat %>%
  select(depvar2, indepvar2, published, elecsys2, method,agglevel, location2) %>%
  rename(Depvar = depvar2,
         Indepvar = indepvar2,
         Published = published,
         "Electoral System" = elecsys2,
         Method = method,
         "Aggregate Level" = agglevel,
         Location = location2)

names <- dat2 %>% 
  map(table) %>%
  unlist() %>%
  names()

aux <- dat2 %>%
  map_df(~{
    table(.x) %>%
      as.data.frame() %>%
      rename(Moderator = ".x") %>%
      mutate(Moderator = as.character(Moderator),
             Pct = paste0(100*(round(Freq/sum(Freq, na.rm = T), digits = 4)), "%"))
  }) %>%
  mutate(Moderator = names,
         Moderator = gsub("\\.", ": ", Moderator),
         Freq = as.character(Freq)) %>%
  bind_rows(.,
            tibble(
              Moderator = "Year",
              Freq = paste0(round(mean(dat$year, na.rm = T), digits=2), " (Mean)"),
              Pct = paste0(as.character(round(median(dat$year, na.rm = T), digits=2)), " (Median)")
            ))

kable(aux,
      booktabs = T,
      align = "c",
      linesep ='') %>% 
  kable_styling(c("striped","bordered","scale_down"), position = "center")

rm(dat2,names)
```



\newpage
## Meta-analysis

We combined the three independent variables (N, logN, and K) with the levels of the three dependent variables (ExpPC, logExpPC, PCTGDP). This formed a 3x3 possibility for our analysis.

### ExpPC x N

```{r, echo=FALSE}
# Pooling effects analysis -- ExpPC x N
aux <- dat %>%
  filter(indepvar2 == 'N',
         depvar2 == 'ExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of lower houses size (N) on Per Capita Expenditure (ExpPC)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f1 <- build_forest(mod, NULL, lsize = 15)
```


Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`


\newpage
#### Electoral system subgroup analysis

The law of 1/n was created for majoritarian systems. In the theoretical section below, we explain why the argument have potential issues when applied to non-majoritarian electoral systems. We estimated a subgroup analysis using a binary electoral system.

```{r, echo=FALSE, fig.width=8, fig.height=6, fig.cap="Subgroup Analysis of (N) x (ExpPC), controlling by electoral system",warning=FALSE}
mod <- update(mod, byvar = aux$elecsys2, print.byvar = F)

mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()


f1b <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f1b
```

Therefore, we can see that the hypothesis that majoritarian systems produce systematic positive effects was disproved. The majoritarian systems in the sample had a random effects model estimate of -0.25, while the random effects model in the non-majoritarian subgroup fitted a value of 0.08. Both are non-significant, but they reassure us that the absense of effect is not caused by pooling multiple types of electoral systems.


\newpage
### ExpPC x logN

There were no studies that had per capita expenditure in the dependent variable and log of lower house size in the treatment variable.

\newpage
### ExpPC x K

Now we are investigating the upper house size (K). In this model, we investigate the effect of upper house size on expenditure per capita (ExpPC).

```{r}
# Pooling effects analysis -- ExpPC x K
aux <- dat %>%
  filter(indepvar2 == 'K',
         depvar2 == 'ExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=7, fig.height=4, fig.cap="Effect of upper house size (K) on the per capita government expenditure (ExpPC)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f2 <- build_forest(mod, NULL, 15)

ggsave("./plots/fb.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### logExpPC x N

This model estimates the Log of Per Capita Expenditure as the dependent variable, and the number of lower house legislators as the treatment variable.

```{r}
# Pooling effects analysis -- logExpPC x N
aux <- dat %>%
  filter(indepvar2 == 'N',
         depvar2 == 'logExpPC')

mod <- metagen(
  coef, SE, data=aux, 
  studlab=paste(authoryear),
  comb.fixed = FALSE,
  comb.random = TRUE,
  method.tau = "REML",
  hakn = TRUE,
  prediction = TRUE,
  sm="SMD"
  )

mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=3, fig.cap="Effect of lower houses size (N) on log of per capita expenditure (logExpPC)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f3 <- build_forest(mod, NULL, 15)

ggsave("./plots/fc.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### logExpPC x logN

In this specification, we study the log of per capita expenditure (logExpPC) as a function of the log of lower house size (logN).

```{r}
# Pooling effects analysis -- logExpPC x logN
aux <- dat %>%
  filter(indepvar2 == 'logN',
         depvar2 == 'logExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of log lower houses size (logN) on the log of per capita government expenditure (logExpPC)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f4  <- build_forest(mod, NULL, 15)

ggsave("./plots/fd.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`). **This model is significant at the 10\% confidence level.**
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### logExpPC x K

No studies related the log of per capita expenditure with the size of upper house (K).

### PCTGDP x N

This model fits the random effects for the percentage of GDP as public expenditure as the main outcome, and the size of lower house as the main treatment variable.

```{r}
# Pooling effects analysis -- PCTGDP x N
aux <- dat %>%
  filter(indepvar2 == 'N',
         depvar2 == 'PCTGDP')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=3, fig.cap="Effect of lower houses size (N) on percentage of public expenditure GDP (PCTGDP)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f5 <- build_forest(mod, NULL, 15)

ggsave("./plots/fe.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### PCTGDP x logN

This meta-regression investigates the percentage of GDP as public expenditure as the dependent variable and the log lower house size (logN) as the treatment variable.

```{r}
# Pooling effects analysis -- PCTGDP x logN
aux <- dat %>%
  filter(indepvar2 == 'logN',
         depvar2 == 'PCTGDP')

mod <- metagen(
  coef, SE, data=aux, 
  studlab=paste(authoryear),
  comb.fixed = FALSE,
  comb.random = TRUE,
  method.tau = "REML",
  hakn = TRUE,
  prediction=TRUE,
  sm="SMD"
  )

mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of log lower houses size (logN) on the GDP share of public expenditure (PCTGDP)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f6 <- build_forest(mod, NULL, 15)

ggsave("./plots/ff.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### PCTGDP x K

This model looks into the effect of upper house size (K) on the public expenditure share of the GDP (PCTGDP).

```{r}
# Pooling effects analysis -- PCTGDP x K
aux <- dat %>%
  filter(indepvar2 == 'K',
         depvar2 == 'PCTGDP')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of upper house size (K) on the public expenditure share of the GDP (PCTGDP)",warning=FALSE}
build_forest(mod, NULL)
```

```{r,include=F,warning=F}
f7 <- build_forest(mod, NULL, 15)

ggsave("./plots/fg.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`


\newpage
```{r,include=F,warning=F}
blank = ggplot() + 
  geom_blank() +
  theme_minimal()
blank
ggsave("./plots/zz_blank.png", width = 30, height = 18.75, units = "cm")

plots = list.files(path = "./plots/", pattern = "*.png") %>%
  map(~{
    image_read(path = paste0("./plots/", .x)) %>%
      image_rotate(., 270) %>%
      image_border(., "#ffffff ", "90x18")
  })
```

```{r, echo=FALSE, fig.width=20, fig.height=5}

p_1 = image_append(c(plots[[3]], plots[[2]], plots[[1]]), stack = T)
p_2 = image_append(c(plots[[6]], plots[[5]], plots[[4]]), stack = T)
p_3 = image_append(c(plots[[15]],plots[[7]],plots[[15]]), stack = T)
p_full = image_append(c(p_1, p_2, p_3))

p_full

f <- ggarrange(f1, f2, f3, f4, f5, f6, f7, 
               labels = c("ExpPC x N", 
                          "ExpPC x K", 
                          "logExpPC x N", 
                          'logExpPC x logN', 
                          'PCTGDP x N',
                          'PCTGDP x logN',
                          'PCTGDP x K'),
               ncol = 2, nrow = 4, 
               font.label = list(size=13, face = 'bold'),
               hjust = 0)
ggsave("./plots/fig.pdf", plot = f, width = 21, height = 29, units = "cm")

f <- ggarrange(f1, f2, f3, f4, f5, f6, f7, 
               labels = c("ExpPC x N", 
                          "ExpPC x K", 
                          "logExpPC x N", 
                          'logExpPC x logN', 
                          'PCTGDP x N',
                          'PCTGDP x logN',
                          'PCTGDP x K'),
               ncol = 3, nrow = 3, 
               font.label = list(size=13, face = 'bold'),
               hjust = 0)
ggsave("./plots/fig2.pdf", plot = f, width = 29, height = 21, units = "cm")


```



\newpage
## Meta-Analysis (all coefficients)

### ExpPC x N

```{r, echo=FALSE}
# Pooling effects analysis -- ExpPC x N
aux <- fulldat %>%
  filter(indepvar2 == 'N',
         depvar2 == 'ExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=12, fig.height=6, fig.cap="Effect of lower houses size (N) on Per Capita Expenditure (ExpPC)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()

f8 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 9, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f8
```

```{r,include=F,warning=F}
f8 + 
  labs(caption = "ExpPC x N") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fh.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
#### Electoral system subgroup analysis

The law of 1/n was created for majoritarian systems. In the theoretical section below, we explain why the argument have potential issues when applied to non-majoritarian electoral systems. We estimated a subgroup analysis using a binary electoral system.

```{r, echo=FALSE, fig.width=8, fig.height=6, fig.cap="Subgroup Analysis of (N) x (ExpPC), controlling by electoral system",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()

f8b <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 13, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 
f8b
```

Therefore, we can see that the hypothesis that majoritarian systems produce systematic positive effects was disproved. The majoritarian systems in the sample had a random effects model estimate of -0.25, while the random effects model in the non-majoritarian subgroup fitted a value of 0.08. Both are non-significant, but they reassure us that the absense of effect is not caused by pooling multiple types of electoral systems.


\newpage
### ExpPC x logN

There were no studies that had per capita expenditure in the dependent variable and log of lower house size in the treatment variable.


\newpage
### ExpPC x K

Now we are investigating the upper house size (K). In this model, we investigate the effect of upper house size on expenditure per capita (ExpPC).

```{r}
# Pooling effects analysis -- ExpPC x K
aux <- fulldat %>%
  filter(indepvar2 == 'K',
         depvar2 == 'ExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=7, fig.height=4, fig.cap="Effect of upper house size (K) on the per capita government expenditure (ExpPC)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()


f9 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 12, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f9
```

```{r,include=F,warning=F}
f9 + 
  labs(caption = "ExpPC x K") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 12, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fi.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### logExpPC x N

This model estimates the Log of Per Capita Expenditure as the dependent variable, and the number of lower house legislators as the treatment variable.

```{r}
# Pooling effects analysis -- logExpPC x N
aux <- fulldat %>%
  filter(indepvar2 == 'N',
         depvar2 == 'logExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=3, fig.cap="Effect of lower houses size (N) on log of per capita expenditure (logExpPC)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()


f10 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 13, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f10
```

```{r,include=F,warning=F}
f10 + 
  labs(caption = "logExpPC x N") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fj.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

\newpage
### logExpPC x logN

In this specification, we study the log of per capita expenditure (logExpPC) as a function of the log of lower house size (logN).

```{r}
# Pooling effects analysis -- logExpPC x logN
aux <- fulldat %>%
  filter(indepvar2 == 'logN',
         depvar2 == 'logExpPC')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of log lower houses size (logN) on the log of per capita government expenditure (logExpPC)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()

f11 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f11
```

```{r,include=F,warning=F}
f11 + 
  labs(caption = "logExpPC x logN") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fk.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`). **This model is significant at the 10\% confidence level.**
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

### logExpPC x K

No studies related the log of per capita expenditure with the size of upper house (K).


\newpage
### PCTGDP x N

This model fits the random effects for the percentage of GDP as public expenditure as the main outcome, and the size of lower house as the main treatment variable.

```{r}
# Pooling effects analysis -- PCTGDP x N
aux <- fulldat %>%
  filter(indepvar2 == 'N',
         depvar2 == 'PCTGDP')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=3, fig.cap="Effect of lower houses size (N) on percentage of public expenditure GDP (PCTGDP)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()

f12 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 10, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 
f12
```

```{r,include=F,warning=F}
f12 + 
  labs(caption = "PCTGDP x N") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 13, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fl.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

### PCTGDP x logN

This meta-regression investigates the percentage of GDP as public expenditure as the dependent variable and the log lower house size (logN) as the treatment variable.

```{r}
# Pooling effects analysis -- PCTGDP x logN
aux <- fulldat %>%
  filter(indepvar2 == 'logN',
         depvar2 == 'PCTGDP')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of log lower houses size (logN) on the GDP share of public expenditure (PCTGDP)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()


f13 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f13
```

```{r,include=F,warning=F}
f13 + 
  labs(caption = "PCTGDP x logN") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 20, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fm.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`

### PCTGDP x K

This model looks into the effect of upper house size (K) on the public expenditure share of the GDP (PCTGDP).

```{r}
# Pooling effects analysis -- PCTGDP x K
aux <- fulldat %>%
  filter(indepvar2 == 'K',
         depvar2 == 'PCTGDP')

mod <- metagen(coef, SE, data=aux, 
          studlab=paste(authoryear),
          comb.fixed = FALSE,
          comb.random = TRUE,
          method.tau = "REML",
          hakn = TRUE,
          prediction=TRUE,
          sm="SMD")
mod
```

And the forest plot:

```{r, echo=FALSE, fig.width=8, fig.height=4, fig.cap="Effect of upper house size (K) on the public expenditure share of the GDP (PCTGDP)",warning=FALSE}
mod2 <- tibble(
  TE = mod$TE,
  seTE = mod$seTE,
  studlab = mod$studlab,
  lower = mod$lower,
  upper = mod$upper,
  group = "A") %>%
  bind_rows(.,
            aux = tibble(
              TE = c(mod$TE.random, NA),
              seTE = c(mod$seTE.random, NA),
              studlab = c("Overall Effect", "Prediction Interval"),
              lower = c(mod$lower.random, mod$lower.predict),
              upper = c(mod$upper.random, mod$upper.predict),
              group = "B")) %>%
  group_by(studlab) %>%
  mutate(studlab2 = paste0(studlab, "_", 1:n())) %>%
  ungroup()


f14 <- mod2 %>%
  ggplot(aes(y = reorder(studlab2,TE), x = TE, xmin = lower, xmax = upper)) +
  # Studies coefs
  geom_point(aes(color = group)) +
  # Error Bars
  geom_errorbarh(aes(color = group), height = 0.1) +
  # Colors
  scale_color_manual(values = c("#000000", "#8b0000")) + 
  # X-axis limit
  scale_x_continuous(limits=c(1.2*(min(mod2$lower)), 1.2*(max(mod2$upper)))) +
  # Y-axis names
  scale_y_discrete(labels = function(x) str_replace(x, "_[0-9]*$", "")) + 
  # Vertical dashed line
  geom_vline(xintercept=0, color="#000000", linetype="dashed") +
  # Labels
  labs(x = "",
       y = "") + 
  # Facet - Separating Studies from Overall Effect
  facet_grid(group~., scales = "free", space = "free") + 
  # Theme
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1)) 

f14
```

```{r,include=F,warning=F}
f14 + 
  labs(caption = "PCTGDP x K") +
  theme_minimal() %+replace%
  theme(strip.text.y = element_blank(),
        legend.position = "none",
        axis.text.y = element_text(size = 15, hjust = 1.1),
        axis.text.x = element_text(size = 15, hjust = 1.1),
        plot.caption = element_text(size=22)) 

ggsave("./plots/fn.png", width = 30, height = 18.75, units = "cm")

```

Highlights:

1. The results are highly heterogeneous: $I^2 = $ `r round(mod$I2*100, 2)`.
2. The Random effects modem SMD estimated is $g = $ `r round(mod$TE.random,2)` ($SE =$ `r round(mod$seTE.random,3)`).
3. The prediction interval ranges from `r round(mod$lower.predict,2)` to `r round(mod$upper.predict,2)`. Therefore, it `r ifelse(((mod$lower.predict)*(mod$upper.predict))>0,'does not emcompasses zero.','emcompasses zero.')`



```{r, echo=FALSE, fig.width=20, fig.height=2}

p_1 = image_append(c(plots[[10]], plots[[9]], plots[[8]]), stack = T)
p_2 = image_append(c(plots[[13]], plots[[12]], plots[[11]]), stack = T)
p_3 = image_append(c(plots[[15]],plots[[14]],plots[[15]]), stack = T)
p_full = image_append(c(p_1, p_2, p_3))

p_full

```


\newpage
## Meta-regressions


### Meta-regressions for Expenditure measured as 

### Meta-regressions for Expenditure as a Percentage of the GDP

```{r, echo=F, warning=F}
mod <-  rma(yi = coef, 
              sei = SE, 
              data = dat, 
              method = "REML", 
              mods = ~indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha",
            subset = dat$depvar2=='PCTGDP',
            slab = dat$authoryear)

mod1 <- tibble(
     ` ` = c("Intercept", "Indepvar: N", "Indepvar: logN", "Year", "Published: No",
          "Elecsys: Non-Majoritarian", "Method: Panel", "AggLevel: States", "Location: World"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ", 
              round(mod[["ci.ub"]], digits = 4), ")"),
  model = "PCTGDP"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 4)))


```

```{r}
summary(mod)
```

As we have considerable heterogeneity in our sample, we run a permutation test to ensure the validity of our estimates. The results follow below.

```{r, echo=FALSE}
mod <- permutest(mod, progbar = F)
mod

mod1_permu <- tibble(
     ` ` = c("Intercept", "Indepvar: N", "Indepvar: logN", "Year", "Published: No",
          "Elecsys: Non-Majoritarian", "Method: Panel", "AggLevel: States", "Location: World"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "PCTGDP - Permutation"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 


```


We have the following results for the meta-regressions of Expenditure Per Capita:

1. Compared with `K`, models with `N` and `logN` find significantly negative coefficients.
2. Year has null effect.
3. Unpublished papers tend to have higher coefficients than published papers.
4. Passing from `Majoritarian` to `Non-Majoritarian`, decreases significantly the effects found in our models.
5. In terms of the modeling, passing from `OLS` to `PANEL` increases the detected effects.
6. When passing from `Local` to `State` or `World` levels, it decreases the detected effect size.

Below we also run the meta-regressions adding all coefficients in the papers. The results follow below:

```{r, echo=F, warning=F}
mod <- rma(yi = coef, 
              sei = SE, 
              data = fulldat, 
              method = "REML", 
              mods = ~ indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha",
            subset = fulldat$depvar2=='PCTGDP',
            slab = fulldat$authoryear)

mod2 <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Indepvar: logN", "Year", "Published: No",
          "Elecsys: Non-Majoritarian", "Method: Panel", "AggLevel: States", "Location: World"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "PCTGDP - All coefs"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

```{r}
summary(mod)
```

```{r, echo=FALSE}

mod <- permutest(mod, progbar = F)
mod 

mod2_permu <- tibble(
     ` ` = c("Intercept", "Indepvar: N", "Indepvar: logN", "Year", "Published: No",
          "Elecsys: Non-Majoritarian", "Method: Panel", "AggLevel: States", "Location: World"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "PCTGDP - All coefs - Permutation"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```


For all the coefficients, we have the following results:

1. Compared with `K`, models with `N` and `logN` tend to have significantly negative coefficients.
2. Year has a positive effect: the younger the publication, the higher the detected coefficient.
3. Unpublished papers tend to have higher coefficients than published papers.
4. Passing from `Majoritarian` to `Non-Majoritarian`, decreases significantly the effects found in our models.
5. In terms of the modeling, passing from `OLS` to `PANEL` increases the detected effects.
6. When passing from `Local` to `State` or `World` levels, it decreases the detected effect size.

### Meta-regressions for Expenditure Per Capita

```{r, echo=F, warning=F}
mod <-  rma(yi = coef, 
              sei = SE, 
              data = dat, 
              method = "REML", 
              mods = ~indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha",
            subset = dat$depvar2=='ExpPC',
            slab = dat$authoryear)

mod3 <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Elecsys: Non-Majoritarian", "Method: Panel",
          "Method: IV", "AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "ExpPC"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

```{r}
summary(mod)
```

As we have considerable heterogeneity in our sample, we run a permutation test to ensure the validity of our estimates. The results follow below.

```{r, echo=FALSE}
mod <- permutest(mod, progbar = F)
mod 

mod3_permu <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Elecsys: Non-Majoritarian", "Method: Panel",
          "Method: IV", "AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "ExpPC - Permutation"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```


We have the following results for the meta-regressions of Expenditure Per Capita:

1. Compared with `K`, models with `N` tend to detect significantly smaller effects.
2. Year has null effect.
3. Passing the electoral rules from `Majoritarian` to `Non-Majoritarian`, increases significantly the per capita expenditure found in our models.
4. In terms of the modeling, passing from `OLS` to `PANEL` or `IV` increases the detected effects.
5. When passing from `Local` to `State` level, decreases the detected effects.

Below we also run the meta-regressions adding all coefficients in the papers. The results follow below:

```{r, echo=F, warning=F}
mod <- rma(yi = coef, 
              sei = SE, 
              data = fulldat, 
              method = "REML", 
              mods = ~ indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha",
            subset = fulldat$depvar2=='ExpPC',
            slab = fulldat$authoryear)

mod4 <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Elecsys: Non-Majoritarian",
             "Method: Panel", "Method: IV" ,"AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "ExpPC - All coefs"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

```{r}
summary(mod)
```

```{r, echo=FALSE}

mod <- permutest(mod, progbar = F)
mod


mod4_permu <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Elecsys: Non-Majoritarian",
             "Method: Panel", "Method: IV" ,"AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "ExpPC - All coefs - Permutation"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

With all coefficients, the results of the effect sizes on the Expenditure Per Capita Regressions are the following:

1. Compared with `K`, models with `N` tend to detect significantly smaller effects.
2. Year has now a positive effect on coefficient sizes.
3. Passing the electoral rules from `Majoritarian` to `Non-Majoritarian`, increases significantly the effects on per capita expenditure found in our models.
4. In terms of the modeling, passing from `OLS` to `PANEL` decreases the detected effects.
5. All other coeffients were not significant.

### Meta-regressions for the Log of Expenditure Per Capita

```{r, echo=F, warning=F}
mod <-  rma(yi = coef, 
              sei = SE, 
              data = dat, 
              method = "REML", 
              mods = ~indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha",
            subset = dat$depvar2=='logExpPC',
            slab = dat$authoryear)


mod5 <- tibble(
   ` ` = c("Intercept", "Indepvar: N", "Year", "Published: No",
             "Method: Panel", "AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "logExpPC"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

```{r}
summary(mod)
```

As we have considerable heterogeneity in our sample, we run a permutation test to ensure the validity of our estimates. The results follow below.

```{r, echo=FALSE}
mod <- permutest(mod, progbar = F)
mod

mod5_permu <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Published: No",
             "Method: Panel", "AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4 ), ")"),
  model = "logExpPC - Permutation"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

mod5_permu %>%
  select(-model) %>%
  kable(booktabs = T,align = "c",linesep ='') %>%
  kable_styling(c("striped","bordered","scale_down"), position = "center")


```

We have the following results for the meta-regressions of Log of Expenditure Per Capita:

1. Unpublished papers report a significantly higher coefficient.
2. In terms of the modeling, passing from `OLS` to `PANEL` increases the detected effects.
3. All other coefficients remained insignificant.

Below we also run the meta-regressions adding all coefficients in the papers. The results follow below:

```{r, echo=F, warning=F}
mod <- rma(yi = coef, 
              sei = SE, 
              data = fulldat, 
              method = "REML", 
              mods = ~ indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha",
            subset = fulldat$depvar2=='logExpPC',
            slab = fulldat$authoryear)

mod6 <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Published: No",
             "Method: Panel", "Method: RDD", "AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4), ")"),
  model = "logExpPC - All coefs"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

```{r}
summary(mod)
```

```{r, echo=FALSE}
mod <- permutest(mod, progbar = F)
mod 

mod6_permu <- tibble(
  ` ` = c("Intercept", "Indepvar: N", "Year", "Published: No",
             "Method: Panel", "Method: RDD", "AggLevel: States"),
  Estimate = mod[["beta"]],
  SE = mod[["se"]],
  `T` = mod[["zval"]],
  `P-Value` = mod[["pval"]],
  CI = paste0("(", round(mod[["ci.lb"]], digits = 4), " ; ",
              round(mod[["ci.ub"]], digits = 4), ")"),
  model = "logExpPC - All coefs - Permutation"
) %>%
  mutate_if(is.numeric, list(~round(., digits = 3))) 

```

With all coefficients, the results of the effect sizes on the Log of Expenditure Per Capita Regressions are the following:

1. In terms of the modeling, passing from `OLS` to `PANEL` or `RDD` decreases the detected effects.
2. All other coefficients remained insignificant.


```{r, echo=F, warning=F,error=F,message=F}
coefs = bind_rows(
  mod1,
  mod2,
  mod3,
  mod4,
  mod5) %>%
  select(` `) %>%
  distinct()

aux = list(mod3, mod5, mod1) %>%
  map(~{
    left_join(coefs, .x) %>%
      mutate(model = ifelse(is.na(model), model[1], model)) 
  }) %>%
  reduce(bind_cols) %>%
  mutate(order = ifelse(` ` == "Intercept", 1, NA),
         order = ifelse(` ` == "Indepvar: N", 2, order),
         order = ifelse(` ` == "Indepvar: logN", 3, order),
         order = ifelse(` ` == "Year", 4, order),
         order = ifelse(` ` == "Published: No", 5, order),
         order = ifelse(` ` == "Elecsys: Non-Majoritarian", 6, order),
         order = ifelse(` ` == "Method: Panel", 7, order),
         order = ifelse(` ` == "Method: IV", 8, order),
         order = ifelse(` ` == "AggLevel: States", 9, order),
         pval = ifelse(`P-Value` < 0.05, "*", NA),
         pval = ifelse(`P-Value` < 0.01, "**", pval),
         pval = ifelse(`P-Value` < 0.01, "***", pval),
         pval = ifelse(`P-Value` >= 0.05, " ", pval),
         `P-Value` = pval) %>%
  arrange(order) %>%
  select(-` 1`, -` 2`, -contains("model"), -order) %>%
  mutate(mod = "Base") %>%
  select(mod, everything())

aux2 = list(mod4, mod6, mod2) %>%
  map(~{
    left_join(coefs, .x) %>%
      mutate(model = ifelse(is.na(model), model[1], model)) 
  }) %>%
  reduce(bind_cols) %>%
  mutate(order = ifelse(` ` == "Intercept", 1, NA),
         order = ifelse(` ` == "Indepvar: N", 2, order),
         order = ifelse(` ` == "Indepvar: logN", 3, order),
         order = ifelse(` ` == "Year", 4, order),
         order = ifelse(` ` == "Published: No", 5, order),
         order = ifelse(` ` == "Elecsys: Non-Majoritarian", 6, order),
         order = ifelse(` ` == "Method: Panel", 7, order),
         order = ifelse(` ` == "Method: IV", 8, order),
         order = ifelse(` ` == "AggLevel: States", 9, order),
         pval = ifelse(`P-Value` < 0.05, "*", NA),
         pval = ifelse(`P-Value` < 0.01, "**", pval),
         pval = ifelse(`P-Value` < 0.01, "***", pval),
         pval = ifelse(`P-Value` >= 0.05, " ", pval),
         `P-Value` = pval) %>%
  arrange(order) %>%
  select(-` 1`, -` 2`, -contains("model"), -order) %>%
  mutate(mod = "All Coefs") %>%
  select(mod, everything())

aux <- bind_rows(aux, aux2) %>%
  select(-contains("CI"),-`T`,-T1,-T2,-pval)

```


\blandscape

## Summary of Results
```{r, echo=F, warning=F,error=F,message=F,asis=T}
kable(aux, 
      booktabs = T,
      longtable = F,
      align = "c",
      linesep ='',
      col.names = c(
        " ",
        " ",
        "Estimate",
        "SE",
        "P-Value",
        #
        "Estimate",
        "SE",
        "P-Value",
        #
        "Estimate",
        "SE",
        "P-Value"
      )) %>% 
  collapse_rows(
    1:2,
    row_group_label_position ='stack'
    ) %>%
  add_header_above(c(" ", " ","ExpPC" = 3, "logExpPC" = 3, "PCTGDP" = 3)) %>%
  kable_styling(
    c("striped",
      "bordered", 
      "scale_down",
      "repeat_header"
      ),
    position = "center",
    latex_options = c("repeat_header")) %>%
  footnote(general = "Signif. codes:  0 ‚Äò***‚Äô 0.001 ‚Äò**‚Äô 0.01 ‚Äò*‚Äô 0.05 ‚Äò.‚Äô 0.1 ‚Äò ‚Äô 1")

```
\elandscape


```{r, echo=F, warning=F,error=F,message=F}
coefs = bind_rows(
  mod1_permu,
  mod2_permu,
  mod3_permu,
  mod4_permu,
  mod5_permu) %>%
  select(` `) %>%
  distinct()

aux = list(mod3_permu, mod5_permu, mod1_permu) %>%
  map(~{
    left_join(coefs, .x) %>%
      mutate(model = ifelse(is.na(model), model[1], model)) 
  }) %>%
  reduce(bind_cols) %>%
  mutate(order = ifelse(` ` == "Intercept", 1, NA),
         order = ifelse(` ` == "Indepvar: N", 2, order),
         order = ifelse(` ` == "Indepvar: logN", 3, order),
         order = ifelse(` ` == "Year", 4, order),
         order = ifelse(` ` == "Published: No", 5, order),
         order = ifelse(` ` == "Elecsys: Non-Majoritarian", 6, order),
         order = ifelse(` ` == "Method: Panel", 7, order),
         order = ifelse(` ` == "Method: IV", 8, order),
         order = ifelse(` ` == "AggLevel: States", 9, order),
         pval = ifelse(`P-Value` < 0.05, "*", NA),
         pval = ifelse(`P-Value` < 0.01, "**", pval),
         pval = ifelse(`P-Value` < 0.01, "***", pval),
         pval = ifelse(`P-Value` >= 0.05, " ", pval),
         `P-Value` = pval) %>%
  arrange(order) %>%
  select(-` 1`, -` 2`, -contains("model"), -order) %>%
  mutate(mod = "Base") %>%
  select(mod, everything())

aux2 = list(mod4_permu, mod6_permu, mod2_permu) %>%
  map(~{
    left_join(coefs, .x) %>%
      mutate(model = ifelse(is.na(model), model[1], model)) 
  }) %>%
  reduce(bind_cols) %>%
  mutate(order = ifelse(` ` == "Intercept", 1, NA),
         order = ifelse(` ` == "Indepvar: N", 2, order),
         order = ifelse(` ` == "Indepvar: logN", 3, order),
         order = ifelse(` ` == "Year", 4, order),
         order = ifelse(` ` == "Published: No", 5, order),
         order = ifelse(` ` == "Elecsys: Non-Majoritarian", 6, order),
         order = ifelse(` ` == "Method: Panel", 7, order),
         order = ifelse(` ` == "Method: IV", 8, order),
         order = ifelse(` ` == "AggLevel: States", 9, order),
         pval = ifelse(`P-Value` < 0.05, "*", NA),
         pval = ifelse(`P-Value` < 0.01, "**", pval),
         pval = ifelse(`P-Value` < 0.01, "***", pval),
         pval = ifelse(`P-Value` >= 0.05, " ", pval),
         `P-Value` = pval) %>%
  arrange(order) %>%
  select(-` 1`, -` 2`, -contains("model"), -order) %>%
  mutate(mod = "All Coefs") %>%
  select(mod, everything())

aux <- bind_rows(aux, aux2) %>%
  select(-contains("CI"),-`T`,-T1,-T2,-pval)

```


\blandscape

## Summary of Results (Permutation)
```{r, echo=F, warning=F,error=F,message=F,asis=T}
kable(aux, 
      booktabs = T,
      longtable = F,
      align = "c",
      linesep ='',
      col.names = c(
        " ",
        " ",
        "Estimate",
        "SE",
        "P-Value",
        #
        "Estimate",
        "SE",
        "P-Value",
        #
        "Estimate",
        "SE",
        "P-Value"
      )) %>% 
  collapse_rows(
    1:2,
    row_group_label_position ='stack'
    ) %>%
  add_header_above(c(" ", " ","ExpPC" = 3, "logExpPC" = 3, "PCTGDP" = 3)) %>%
  kable_styling(
    c("striped",
      "bordered", 
      "scale_down",
      "repeat_header"
      ),
    position = "center",
    latex_options = c("repeat_header")) %>%
  footnote(general = "Signif. codes:  0 ‚Äò***‚Äô 0.001 ‚Äò**‚Äô 0.01 ‚Äò*‚Äô 0.05 ‚Äò.‚Äô 0.1 ‚Äò ‚Äô 1")

```
\elandscape



\newpage
## Theory of Meta Analysis

There are two main estimators for conducting meta analysis: fixed effects and random effects models. The fixed effects model assumes that there is one true effect in reality, and that all estimates are an attempt to uncover this true effect. The random effects model, on the other hand, assumes that there are a distribution of true effects, that vary based on sample and tests characteristics.

In this paper, we use the random effects model. The empirical papers testing the law of 1/n are very diverse. We tried to capture some of this diversity by considering the main dependent and independent variables separately, but they have at least three other important sources of dispersion:

1. **Subjects**: Counties, Municipalities, States, Provinces, Countries.
2. **Electoral systems**: Majoritarian, PR, Mixed.
3. **Modeling strategies**: Panel data, Standard OLS, IV, RDD.

These sources of heterogeneity have two implications. First, it makes our estimates very disperse. The heterogeneity tests are all but one significant. When the sample sizes are large enough, we removed more heterogeneous studies, but we still had considerable dispersion in our estimates. Second, the amount of heterogeneity makes fixed effects estimates unrealistic and bised. Thus, we opt for random effects model.

Let each study having an effect of $T_i$. In a random effects model, we can decompose this effect in two components, the true effect that the study with the same specifications as $i$ come from, $\theta_i$, and a within-study error $\varepsilon_i$:

\[
T_i \ = \ \theta_i + \varepsilon_i
\]

And the random effects model assumes that the $\theta_i$ varies from study to study, having a true parameter $\mu$, plus a between-study error, $\xi_i$:

\[
T_i \ = \ \mu + \xi_i + \varepsilon_i
\]

And the random effects model estimates the parameter $\mu$, under the challenge of estimating both the within-and-between-study sampling errors.

In all empirical estimates, we use the package `meta`, and the package `dmetar`, described in (Doing Meta-Analysis with R)[https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/random.html]. To empirically implement the random effects model, we need to choose a method to estimate the true effect size variance, $\tau^2$, which in our formulation, represents the variance of $\xi_i$. We selected the **Restricted Maximum Likelihood Estimator**, as the literature regards it as more precise when we have continuous measures, such as we have on our data (link)[https://www.ncbi.nlm.nih.gov/pubmed/26332144].

## Robustness: Full model meta-regressions combined

In this section, we aggregate all the coefficients and run a multivariate meta-regression, controlling by:

1. The type of the dependent variable in the study (expenditure per capita, log of the expenditure per capita, and share of government expenditure in the GDP)
2. The type of the independent variable in the stydy (N, K, log of N);
3. The electoral system (Majoritarian, Proportional Representation, and Mixed).

The results follow below, and show null effect for all variables, including the intercept.

```{r, echo=F, warning=F}
mod <-  rma(yi = coef, 
              sei = SE, 
              data = dat, 
              method = "REML", 
              mods = ~ depvar2+indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha")

```

```{r}
summary(mod)
```

As we have considerable heterogeneity in our sample, we run a permutation test to ensure the validity of our estimates. The results follow below.

```{r, echo=FALSE}
permutest(mod, progbar = F)
```

In the main text, we selected the coefficients based on the regressions that had most observations and that presented a full model (with fixed effects or intermediate bandwidth in RDD). Below we also run the meta-regressions adding all coefficients in the papers. The results follow below:

```{r, echo=F, warning=F}
mod <- rma(yi = coef, 
              sei = SE, 
              data = fulldat, 
              method = "REML", 
              mods = ~ depvar2+indepvar2+year+published+elecsys2+method+agglevel+location2, 
              test = "knha")

```

```{r}
summary(mod)
```

```{r, echo=F, warning=F}
permutest(mod, progbar = F)

```

